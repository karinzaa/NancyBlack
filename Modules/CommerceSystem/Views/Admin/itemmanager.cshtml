@inherits NantCom.NancyBlack.NancyBlackRazorViewBase
@{
    Layout = "_admin.cshtml";
}

@section Title
    {
    Administration - Item Manager
}

@section Script
{

    <script>
        (function () {
            
            window.data = @this.Html.Raw(this.GetJson(this.Model.Data));
            var mod = angular.module("page", []);
            mod.controller("PageController", function ($scope, $rootScope, $timeout) {

                var $me = this;

                $scope.data = window.data;

            });

        })();
    </script>

}

<div ng-module="page" ng-controller="PageController as ctrl">

    <h1 class="page-header">
        Item Manager
        <i class="fa fa-spinner fa-circle-o-notch" ng-show="isBusy"></i>
    </h1>

    <div style="margin-bottom: 30px">
        This page helps you tracks Inventory Changes.
    </div>

    <div>
        <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">
            {{alert.msg}}
        </alert>
    </div>

    <tabset>
        <tab heading="Overall">

            <div class="col-md-4">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        Waiting to Order
                    </div>
                    <div class="panel-body">

                        <table class="table table-striped table-hover table-responsive">
                            <tr>
                                <th>Id</th>
                                <th>Item</th>
                                <th>SO</th>
                                <th>PO</th>
                            </tr>
                            <tr ng-repeat="item in data.WaitingToOrderItems">
                                <td>{{item.Id}}</td>
                                <td>
                                    <div style="text-align: left">
                                        {{item.ProductTitle}}
                                    </div>
                                </td>
                                <td>{{item.SaleOrderId}}</td>
                                <td>{{item.PurchaseOrderId}}</td>
                            </tr>
                        </table>

                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        Waiting for Items
                    </div>
                    <div class="panel-body">

                        <table class="table table-striped table-hover table-responsive">
                            <tr>
                                <th>Id</th>
                                <th>Item</th>
                                <th>SO</th>
                                <th>PO</th>
                            </tr>
                            <tr ng-repeat="item in data.WaitingForOrderItems">
                                <td>{{item.Id}}</td>
                                <td>
                                    <div style="text-align: left">
                                        {{item.ProductTitle}}
                                    </div>
                                </td>
                                <td>{{item.SaleOrderId}}</td>
                                <td>{{item.PurchaseOrderId}}</td>
                            </tr>
                        </table>

                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        In Stock
                    </div>
                    <div class="panel-body">

                        <table class="table table-striped table-hover table-responsive">
                            <tr>
                                <th>Id</th>
                                <th>Item</th>
                                <th>SO</th>
                                <th>PO</th>
                            </tr>
                            <tr ng-repeat="item in data.InStockItems">
                                <td>{{item.Id}}</td>
                                <td>
                                    <div style="text-align: left">
                                        {{item.ProductTitle}}
                                    </div>
                                </td>
                                <td>{{item.SaleOrderId}}</td>
                                <td>{{item.PurchaseOrderId}}</td>
                            </tr>
                        </table>

                    </div>
                </div>
            </div>

        </tab>
        <tab heading="Group by PO">

            <div class="col-md-4" ng-repeat="group in data.PendingItemsBySupplierId">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <span ncb-vlookup="supplier" key="{{group.SupplierId}}" label="Name">
                        </span>
                    </div>
                    <div class="panel-body">

                        <table class="table table-responsive">
                            <tr>
                                <th>Id</th>
                                <th>Item</th>
                                <th>Status</th>
                                <th>SO</th>
                                <th>PO</th>
                            </tr>
                            <tr ng-repeat="item in group.Items" 
                                ng-class="{'bg-info': !item.WasOrdered, 'bg-warning': item.WasOrdered && !item.WasReceived, 'bg-success': item.WasReceived}">
                                <td>
                                        {{item.Id}}
                                </td>
                                <td>
                                    <div style="text-align: left">
                                        {{item.ProductTitle}}
                                    </div>
                                </td>
                                <td>
                                    <div style="text-align: left">
                                        {{item.WasOrdered == false ? 'Did not order' : ''}}
                                        {{item.WasOrdered && !item.WasReceived ? 'Did Order' : ''}}
                                        {{item.WasReceived ? 'In Stock' : ''}}
                                    </div>
                                </td>
                                <td>{{item.SaleOrderId}}</td>
                                <td>{{item.PurchaseOrderId}}</td>
                            </tr>
                        </table>

                    </div>
                </div>
            </div>

        </tab>
    </tabset>


</div>